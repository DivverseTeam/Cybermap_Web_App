import {
  Doc02Icon,
  Xls02Icon,
  Delete02Icon,
  CheckmarkCircle04Icon,
} from "hugeicons-react";
import { useSession } from "next-auth/react";
import Link from "next/link";
import axios, { AxiosError } from "axios";
import {
  useParams,
  usePathname,
  useRouter,
  useSearchParams,
} from "next/navigation";
import { useEffect, useState, type FunctionComponent } from "react";
import { useDropzone } from "react-dropzone";
import { Button } from "~/app/_components/ui/button";
import {
  Sheet,
  SheetContent,
  SheetDescription,
  SheetFooter,
  SheetHeader,
  SheetTitle,
} from "~/app/_components/ui/sheet";
import { cn, humanFileSize } from "~/lib/utils";
import { api } from "~/trpc/react";
import { useQuery } from "@tanstack/react-query";

interface PolicyTemplateProps {}

const MimeTypeIconMap = {
  "application/vnd.openxmlformats-officedocument.wordprocessingml.document": (
    <svg
      width="33"
      height="37"
      viewBox="0 0 33 37"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
    >
      <path d="M2.5 30.5801H0L2.5 33.0801V30.5801Z" fill="#1B3591" />
      <path
        d="M29.7998 30.5801H32.2998L29.7998 33.0801V30.5801Z"
        fill="#1B3591"
      />
      <path
        d="M3.35552 1.71162C3.91384 1.09227 4.66518 0.75 5.44238 0.75H22.9153L29.832 8.42294V32.5872C29.832 33.4743 29.514 34.3206 28.955 34.9408C28.3966 35.5601 27.6453 35.9024 26.8681 35.9024H5.44238C4.66518 35.9024 3.91384 35.5601 3.35552 34.9408C2.79644 34.3206 2.47852 33.4743 2.47852 32.5872V4.06524C2.47852 3.17809 2.79644 2.33184 3.35552 1.71162Z"
        fill="#F5F8FF"
        stroke="#2950DA"
        strokeWidth="0.5"
      />
      <path d="M0 18.3262H32.31V30.5817H0V18.3262Z" fill="#2243B6" />
      <path
        d="M27.4369 27.5739H26.363C26.2818 27.5739 26.2156 27.5529 26.1645 27.5107C26.1163 27.4686 26.0757 27.4205 26.0426 27.3663L25.0635 25.7555C25.0484 25.8066 25.0304 25.8547 25.0093 25.8999C24.9913 25.945 24.9702 25.9871 24.9462 26.0262L24.0798 27.3663C24.0467 27.4175 24.0061 27.4656 23.958 27.5107C23.9098 27.5529 23.8497 27.5739 23.7775 27.5739H22.7803L24.3686 25.1869L22.8434 22.9443H23.9174C23.9986 22.9443 24.0587 22.9564 24.0979 22.9804C24.137 23.0015 24.1716 23.0376 24.2016 23.0887L25.1718 24.6319C25.2049 24.5296 25.2515 24.4289 25.3117 24.3296L26.0923 23.1113C26.1585 23 26.2442 22.9443 26.3495 22.9443H27.3738L25.8531 25.1373L27.4369 27.5739Z"
        fill="white"
      />
      <path
        d="M22.2663 23.9234C22.2333 23.9655 22.2002 23.9986 22.1671 24.0227C22.137 24.0468 22.0919 24.0588 22.0317 24.0588C21.9746 24.0588 21.9189 24.0422 21.8648 24.0092C21.8106 23.9731 21.7459 23.934 21.6707 23.8918C21.5955 23.8467 21.5053 23.8076 21.4 23.7745C21.2977 23.7384 21.1699 23.7204 21.0164 23.7204C20.8209 23.7204 20.6495 23.7565 20.5021 23.8287C20.3546 23.8979 20.2313 23.9986 20.132 24.131C20.0358 24.2633 19.9636 24.4243 19.9155 24.6138C19.8673 24.8003 19.8433 25.0124 19.8433 25.25C19.8433 25.4967 19.8688 25.7163 19.92 25.9088C19.9741 26.1013 20.0508 26.2638 20.1501 26.3961C20.2494 26.5255 20.3697 26.6248 20.5111 26.694C20.6525 26.7601 20.8119 26.7932 20.9894 26.7932C21.1669 26.7932 21.3097 26.7722 21.418 26.7301C21.5293 26.6849 21.6226 26.6368 21.6978 26.5857C21.773 26.5315 21.8377 26.4834 21.8918 26.4413C21.949 26.3961 22.0122 26.3736 22.0813 26.3736C22.1716 26.3736 22.2393 26.4082 22.2844 26.4774L22.6048 26.8835C22.4814 27.0279 22.3476 27.1497 22.2032 27.249C22.0588 27.3452 21.9084 27.4234 21.7519 27.4836C21.5985 27.5408 21.4391 27.5814 21.2736 27.6054C21.1112 27.6295 20.9488 27.6415 20.7863 27.6415C20.5005 27.6415 20.2313 27.5889 19.9786 27.4836C19.7259 27.3753 19.5048 27.2189 19.3153 27.0143C19.1258 26.8098 18.9754 26.5601 18.8641 26.2653C18.7558 25.9675 18.7017 25.6291 18.7017 25.25C18.7017 24.9101 18.7498 24.5958 18.8461 24.307C18.9453 24.0152 19.0897 23.764 19.2792 23.5534C19.4687 23.3398 19.7034 23.1729 19.9831 23.0526C20.2629 22.9322 20.5848 22.8721 20.9488 22.8721C21.2947 22.8721 21.597 22.9277 21.8557 23.039C22.1174 23.1503 22.3521 23.3098 22.5596 23.5173L22.2663 23.9234Z"
        fill="white"
      />
      <path
        d="M15.8168 22.8721C16.1597 22.8721 16.471 22.9277 16.7508 23.039C17.0336 23.1503 17.2742 23.3083 17.4728 23.5128C17.6743 23.7174 17.8292 23.967 17.9375 24.2618C18.0458 24.5566 18.1 24.886 18.1 25.25C18.1 25.617 18.0458 25.9479 17.9375 26.2427C17.8292 26.5375 17.6743 26.7887 17.4728 26.9963C17.2742 27.2038 17.0336 27.3633 16.7508 27.4746C16.471 27.5859 16.1597 27.6415 15.8168 27.6415C15.4708 27.6415 15.1565 27.5859 14.8737 27.4746C14.5909 27.3633 14.3488 27.2038 14.1472 26.9963C13.9487 26.7887 13.7938 26.5375 13.6825 26.2427C13.5742 25.9479 13.52 25.617 13.52 25.25C13.52 24.886 13.5742 24.5566 13.6825 24.2618C13.7938 23.967 13.9487 23.7174 14.1472 23.5128C14.3488 23.3083 14.5909 23.1503 14.8737 23.039C15.1565 22.9277 15.4708 22.8721 15.8168 22.8721ZM15.8168 26.7842C16.2018 26.7842 16.4861 26.6548 16.6696 26.3961C16.8561 26.1374 16.9493 25.7584 16.9493 25.2591C16.9493 24.7597 16.8561 24.3792 16.6696 24.1175C16.4861 23.8557 16.2018 23.7249 15.8168 23.7249C15.4257 23.7249 15.1354 23.8572 14.9459 24.122C14.7594 24.3837 14.6661 24.7627 14.6661 25.2591C14.6661 25.7554 14.7594 26.1344 14.9459 26.3961C15.1354 26.6548 15.4257 26.7842 15.8168 26.7842Z"
        fill="white"
      />
      <path
        d="M11.5532 24.126C11.4269 23.9726 11.2885 23.8643 11.1381 23.8011C10.9907 23.738 10.8313 23.7064 10.6598 23.7064C10.4914 23.7064 10.3394 23.738 10.2041 23.8011C10.0687 23.8643 9.9529 23.9606 9.85664 24.0899C9.76038 24.2163 9.68668 24.3787 9.63554 24.5772C9.5844 24.7728 9.55883 25.0044 9.55883 25.2721C9.55883 25.5429 9.57989 25.773 9.622 25.9625C9.66712 26.149 9.73029 26.3024 9.81152 26.4228C9.89274 26.5401 9.99201 26.6258 10.1093 26.68C10.2266 26.7311 10.3575 26.7567 10.5019 26.7567C10.7335 26.7567 10.9306 26.7085 11.093 26.6123C11.2554 26.516 11.4089 26.3791 11.5532 26.2017V24.126ZM12.6678 20.8682V27.5734H11.9864C11.839 27.5734 11.7458 27.5057 11.7067 27.3703L11.6119 26.9236C11.4254 27.1372 11.2103 27.3102 10.9667 27.4425C10.726 27.5749 10.4447 27.6411 10.1229 27.6411C9.87017 27.6411 9.63855 27.5884 9.42797 27.4831C9.2174 27.3778 9.03541 27.2259 8.88199 27.0274C8.73158 26.8258 8.61426 26.5777 8.53003 26.2829C8.44881 25.9881 8.4082 25.6512 8.4082 25.2721C8.4082 24.9292 8.45483 24.6103 8.54808 24.3155C8.64134 24.0207 8.7752 23.765 8.94967 23.5484C9.12415 23.3319 9.33322 23.1634 9.57688 23.0431C9.82054 22.9197 10.0943 22.8581 10.3981 22.8581C10.6568 22.8581 10.8779 22.8987 11.0614 22.9799C11.2449 23.0611 11.4089 23.1709 11.5532 23.3093V20.8682H12.6678Z"
        fill="white"
      />
      <path
        d="M6.34375 26.9597C6.34375 26.8664 6.3603 26.7777 6.39338 26.6934C6.42948 26.6092 6.47761 26.537 6.53778 26.4769C6.59794 26.4167 6.67014 26.3686 6.75437 26.3325C6.83859 26.2964 6.92884 26.2783 7.0251 26.2783C7.12136 26.2783 7.2101 26.2964 7.29132 26.3325C7.37555 26.3686 7.44775 26.4167 7.50791 26.4769C7.57108 26.537 7.62072 26.6092 7.65682 26.6934C7.69292 26.7777 7.71096 26.8664 7.71096 26.9597C7.71096 27.0559 7.69292 27.1462 7.65682 27.2304C7.62072 27.3116 7.57108 27.3823 7.50791 27.4425C7.44775 27.5026 7.37555 27.5493 7.29132 27.5824C7.2101 27.6185 7.12136 27.6365 7.0251 27.6365C6.92884 27.6365 6.83859 27.6185 6.75437 27.5824C6.67014 27.5493 6.59794 27.5026 6.53778 27.4425C6.47761 27.3823 6.42948 27.3116 6.39338 27.2304C6.3603 27.1462 6.34375 27.0559 6.34375 26.9597Z"
        fill="white"
      />
    </svg>
  ),
  "application/msword": (
    <svg
      width="33"
      height="37"
      viewBox="0 0 33 37"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
    >
      <path d="M2.5 30.5801H0L2.5 33.0801V30.5801Z" fill="#1B3591" />
      <path
        d="M29.7998 30.5801H32.2998L29.7998 33.0801V30.5801Z"
        fill="#1B3591"
      />
      <path
        d="M3.35552 1.71162C3.91384 1.09227 4.66518 0.75 5.44238 0.75H22.9153L29.832 8.42294V32.5872C29.832 33.4743 29.514 34.3206 28.955 34.9408C28.3966 35.5601 27.6453 35.9024 26.8681 35.9024H5.44238C4.66518 35.9024 3.91384 35.5601 3.35552 34.9408C2.79644 34.3206 2.47852 33.4743 2.47852 32.5872V4.06524C2.47852 3.17809 2.79644 2.33184 3.35552 1.71162Z"
        fill="#F5F8FF"
        stroke="#2950DA"
        strokeWidth="0.5"
      />
      <path d="M0 18.3262H32.31V30.5817H0V18.3262Z" fill="#2243B6" />
      <path
        d="M27.4369 27.5739H26.363C26.2818 27.5739 26.2156 27.5529 26.1645 27.5107C26.1163 27.4686 26.0757 27.4205 26.0426 27.3663L25.0635 25.7555C25.0484 25.8066 25.0304 25.8547 25.0093 25.8999C24.9913 25.945 24.9702 25.9871 24.9462 26.0262L24.0798 27.3663C24.0467 27.4175 24.0061 27.4656 23.958 27.5107C23.9098 27.5529 23.8497 27.5739 23.7775 27.5739H22.7803L24.3686 25.1869L22.8434 22.9443H23.9174C23.9986 22.9443 24.0587 22.9564 24.0979 22.9804C24.137 23.0015 24.1716 23.0376 24.2016 23.0887L25.1718 24.6319C25.2049 24.5296 25.2515 24.4289 25.3117 24.3296L26.0923 23.1113C26.1585 23 26.2442 22.9443 26.3495 22.9443H27.3738L25.8531 25.1373L27.4369 27.5739Z"
        fill="white"
      />
      <path
        d="M22.2663 23.9234C22.2333 23.9655 22.2002 23.9986 22.1671 24.0227C22.137 24.0468 22.0919 24.0588 22.0317 24.0588C21.9746 24.0588 21.9189 24.0422 21.8648 24.0092C21.8106 23.9731 21.7459 23.934 21.6707 23.8918C21.5955 23.8467 21.5053 23.8076 21.4 23.7745C21.2977 23.7384 21.1699 23.7204 21.0164 23.7204C20.8209 23.7204 20.6495 23.7565 20.5021 23.8287C20.3546 23.8979 20.2313 23.9986 20.132 24.131C20.0358 24.2633 19.9636 24.4243 19.9155 24.6138C19.8673 24.8003 19.8433 25.0124 19.8433 25.25C19.8433 25.4967 19.8688 25.7163 19.92 25.9088C19.9741 26.1013 20.0508 26.2638 20.1501 26.3961C20.2494 26.5255 20.3697 26.6248 20.5111 26.694C20.6525 26.7601 20.8119 26.7932 20.9894 26.7932C21.1669 26.7932 21.3097 26.7722 21.418 26.7301C21.5293 26.6849 21.6226 26.6368 21.6978 26.5857C21.773 26.5315 21.8377 26.4834 21.8918 26.4413C21.949 26.3961 22.0122 26.3736 22.0813 26.3736C22.1716 26.3736 22.2393 26.4082 22.2844 26.4774L22.6048 26.8835C22.4814 27.0279 22.3476 27.1497 22.2032 27.249C22.0588 27.3452 21.9084 27.4234 21.7519 27.4836C21.5985 27.5408 21.4391 27.5814 21.2736 27.6054C21.1112 27.6295 20.9488 27.6415 20.7863 27.6415C20.5005 27.6415 20.2313 27.5889 19.9786 27.4836C19.7259 27.3753 19.5048 27.2189 19.3153 27.0143C19.1258 26.8098 18.9754 26.5601 18.8641 26.2653C18.7558 25.9675 18.7017 25.6291 18.7017 25.25C18.7017 24.9101 18.7498 24.5958 18.8461 24.307C18.9453 24.0152 19.0897 23.764 19.2792 23.5534C19.4687 23.3398 19.7034 23.1729 19.9831 23.0526C20.2629 22.9322 20.5848 22.8721 20.9488 22.8721C21.2947 22.8721 21.597 22.9277 21.8557 23.039C22.1174 23.1503 22.3521 23.3098 22.5596 23.5173L22.2663 23.9234Z"
        fill="white"
      />
      <path
        d="M15.8168 22.8721C16.1597 22.8721 16.471 22.9277 16.7508 23.039C17.0336 23.1503 17.2742 23.3083 17.4728 23.5128C17.6743 23.7174 17.8292 23.967 17.9375 24.2618C18.0458 24.5566 18.1 24.886 18.1 25.25C18.1 25.617 18.0458 25.9479 17.9375 26.2427C17.8292 26.5375 17.6743 26.7887 17.4728 26.9963C17.2742 27.2038 17.0336 27.3633 16.7508 27.4746C16.471 27.5859 16.1597 27.6415 15.8168 27.6415C15.4708 27.6415 15.1565 27.5859 14.8737 27.4746C14.5909 27.3633 14.3488 27.2038 14.1472 26.9963C13.9487 26.7887 13.7938 26.5375 13.6825 26.2427C13.5742 25.9479 13.52 25.617 13.52 25.25C13.52 24.886 13.5742 24.5566 13.6825 24.2618C13.7938 23.967 13.9487 23.7174 14.1472 23.5128C14.3488 23.3083 14.5909 23.1503 14.8737 23.039C15.1565 22.9277 15.4708 22.8721 15.8168 22.8721ZM15.8168 26.7842C16.2018 26.7842 16.4861 26.6548 16.6696 26.3961C16.8561 26.1374 16.9493 25.7584 16.9493 25.2591C16.9493 24.7597 16.8561 24.3792 16.6696 24.1175C16.4861 23.8557 16.2018 23.7249 15.8168 23.7249C15.4257 23.7249 15.1354 23.8572 14.9459 24.122C14.7594 24.3837 14.6661 24.7627 14.6661 25.2591C14.6661 25.7554 14.7594 26.1344 14.9459 26.3961C15.1354 26.6548 15.4257 26.7842 15.8168 26.7842Z"
        fill="white"
      />
      <path
        d="M11.5532 24.126C11.4269 23.9726 11.2885 23.8643 11.1381 23.8011C10.9907 23.738 10.8313 23.7064 10.6598 23.7064C10.4914 23.7064 10.3394 23.738 10.2041 23.8011C10.0687 23.8643 9.9529 23.9606 9.85664 24.0899C9.76038 24.2163 9.68668 24.3787 9.63554 24.5772C9.5844 24.7728 9.55883 25.0044 9.55883 25.2721C9.55883 25.5429 9.57989 25.773 9.622 25.9625C9.66712 26.149 9.73029 26.3024 9.81152 26.4228C9.89274 26.5401 9.99201 26.6258 10.1093 26.68C10.2266 26.7311 10.3575 26.7567 10.5019 26.7567C10.7335 26.7567 10.9306 26.7085 11.093 26.6123C11.2554 26.516 11.4089 26.3791 11.5532 26.2017V24.126ZM12.6678 20.8682V27.5734H11.9864C11.839 27.5734 11.7458 27.5057 11.7067 27.3703L11.6119 26.9236C11.4254 27.1372 11.2103 27.3102 10.9667 27.4425C10.726 27.5749 10.4447 27.6411 10.1229 27.6411C9.87017 27.6411 9.63855 27.5884 9.42797 27.4831C9.2174 27.3778 9.03541 27.2259 8.88199 27.0274C8.73158 26.8258 8.61426 26.5777 8.53003 26.2829C8.44881 25.9881 8.4082 25.6512 8.4082 25.2721C8.4082 24.9292 8.45483 24.6103 8.54808 24.3155C8.64134 24.0207 8.7752 23.765 8.94967 23.5484C9.12415 23.3319 9.33322 23.1634 9.57688 23.0431C9.82054 22.9197 10.0943 22.8581 10.3981 22.8581C10.6568 22.8581 10.8779 22.8987 11.0614 22.9799C11.2449 23.0611 11.4089 23.1709 11.5532 23.3093V20.8682H12.6678Z"
        fill="white"
      />
      <path
        d="M6.34375 26.9597C6.34375 26.8664 6.3603 26.7777 6.39338 26.6934C6.42948 26.6092 6.47761 26.537 6.53778 26.4769C6.59794 26.4167 6.67014 26.3686 6.75437 26.3325C6.83859 26.2964 6.92884 26.2783 7.0251 26.2783C7.12136 26.2783 7.2101 26.2964 7.29132 26.3325C7.37555 26.3686 7.44775 26.4167 7.50791 26.4769C7.57108 26.537 7.62072 26.6092 7.65682 26.6934C7.69292 26.7777 7.71096 26.8664 7.71096 26.9597C7.71096 27.0559 7.69292 27.1462 7.65682 27.2304C7.62072 27.3116 7.57108 27.3823 7.50791 27.4425C7.44775 27.5026 7.37555 27.5493 7.29132 27.5824C7.2101 27.6185 7.12136 27.6365 7.0251 27.6365C6.92884 27.6365 6.83859 27.6185 6.75437 27.5824C6.67014 27.5493 6.59794 27.5026 6.53778 27.4425C6.47761 27.3823 6.42948 27.3116 6.39338 27.2304C6.3603 27.1462 6.34375 27.0559 6.34375 26.9597Z"
        fill="white"
      />
    </svg>
  ),
  "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet": (
    <svg
      width="38"
      height="38"
      viewBox="0 0 38 38"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
    >
      <path d="M5.5 31.0801H3L5.5 33.5801V31.0801Z" fill="#006C36" />
      <path
        d="M32.7998 31.0801H35.2998L32.7998 33.5801V31.0801Z"
        fill="#006C36"
      />
      <path
        d="M6.35552 2.21162C6.91384 1.59227 7.66518 1.25 8.44238 1.25H25.9153L32.832 8.92294V33.0872C32.832 33.9743 32.514 34.8206 31.955 35.4408C31.3966 36.0601 30.6453 36.4024 29.8681 36.4024H8.44238C7.66518 36.4024 6.91384 36.0601 6.35552 35.4408C5.79644 34.8206 5.47852 33.9743 5.47852 33.0872V4.56524C5.47852 3.67809 5.79644 2.83184 6.35552 2.21162Z"
        fill="#EBFAF3"
        stroke="#00A251"
        strokeWidth="0.5"
      />
      <path d="M3 18.8262H35.31V31.0817H3V18.8262Z" fill="#008743" />
      <path
        d="M27.4545 28.0729H26.3806C26.2994 28.0729 26.2332 28.0519 26.182 28.0098C26.1339 27.9677 26.0933 27.9195 26.0602 27.8654L25.0811 26.2545C25.066 26.3056 25.048 26.3538 25.0269 26.3989C25.0089 26.444 24.9878 26.4861 24.9637 26.5252L24.0974 27.8654C24.0643 27.9165 24.0237 27.9646 23.9756 28.0098C23.9274 28.0519 23.8673 28.0729 23.7951 28.0729H22.7979L24.3862 25.686L22.861 23.4434H23.9349C24.0162 23.4434 24.0763 23.4554 24.1154 23.4795C24.1545 23.5005 24.1891 23.5366 24.2192 23.5878L25.1893 25.1309C25.2224 25.0287 25.2691 24.9279 25.3292 24.8286L26.1098 23.6103C26.176 23.499 26.2618 23.4434 26.367 23.4434H27.3913L25.8707 25.6363L27.4545 28.0729Z"
        fill="white"
      />
      <path
        d="M22.1804 24.3467C22.1504 24.3948 22.1188 24.4294 22.0857 24.4505C22.0526 24.4685 22.0105 24.4776 21.9593 24.4776C21.9052 24.4776 21.8465 24.4625 21.7834 24.4325C21.7232 24.4024 21.6525 24.3693 21.5713 24.3332C21.4901 24.2941 21.3968 24.2595 21.2915 24.2294C21.1892 24.1993 21.0674 24.1843 20.926 24.1843C20.7064 24.1843 20.5335 24.2309 20.4071 24.3242C20.2838 24.4174 20.2221 24.5392 20.2221 24.6896C20.2221 24.7889 20.2537 24.8731 20.3169 24.9423C20.3831 25.0085 20.4688 25.0672 20.5741 25.1183C20.6824 25.1695 20.8042 25.2161 20.9396 25.2582C21.0749 25.2973 21.2118 25.3409 21.3502 25.389C21.4916 25.4372 21.6299 25.4928 21.7653 25.556C21.9007 25.6162 22.021 25.6944 22.1263 25.7906C22.2346 25.8839 22.3203 25.9967 22.3835 26.1291C22.4497 26.2614 22.4828 26.4209 22.4828 26.6074C22.4828 26.83 22.4421 27.036 22.3609 27.2255C22.2827 27.412 22.1654 27.5745 22.009 27.7129C21.8525 27.8482 21.6585 27.955 21.4269 28.0332C21.1983 28.1084 20.9335 28.146 20.6327 28.146C20.4733 28.146 20.3169 28.131 20.1635 28.1009C20.013 28.0738 19.8672 28.0347 19.7258 27.9836C19.5874 27.9325 19.458 27.8723 19.3377 27.8031C19.2204 27.7339 19.1166 27.6587 19.0264 27.5775L19.2836 27.1533C19.3167 27.1022 19.3558 27.0631 19.4009 27.036C19.446 27.009 19.5032 26.9954 19.5724 26.9954C19.6415 26.9954 19.7062 27.015 19.7664 27.0541C19.8295 27.0932 19.9017 27.1353 19.983 27.1804C20.0642 27.2255 20.1589 27.2677 20.2672 27.3068C20.3785 27.3459 20.5184 27.3654 20.6869 27.3654C20.8192 27.3654 20.932 27.3504 21.0253 27.3203C21.1216 27.2872 21.1998 27.2451 21.2599 27.194C21.3231 27.1428 21.3682 27.0842 21.3953 27.018C21.4254 26.9488 21.4404 26.8781 21.4404 26.8059C21.4404 26.6976 21.4073 26.6089 21.3412 26.5397C21.278 26.4705 21.1923 26.4103 21.084 26.3592C20.9787 26.308 20.8568 26.2629 20.7185 26.2238C20.5831 26.1817 20.4432 26.1366 20.2988 26.0885C20.1574 26.0403 20.0176 25.9847 19.8792 25.9215C19.7438 25.8553 19.622 25.7726 19.5137 25.6733C19.4084 25.5741 19.3227 25.4522 19.2565 25.3078C19.1933 25.1634 19.1617 24.989 19.1617 24.7844C19.1617 24.5949 19.1993 24.4144 19.2745 24.2429C19.3497 24.0715 19.4595 23.9226 19.6039 23.7962C19.7513 23.6669 19.9333 23.5646 20.1499 23.4894C20.3695 23.4112 20.6222 23.3721 20.908 23.3721C21.2268 23.3721 21.5171 23.4247 21.7788 23.53C22.0406 23.6353 22.2586 23.7737 22.4331 23.9451L22.1804 24.3467Z"
        fill="white"
      />
      <path
        d="M18.2454 21.3682V28.0734H17.1309V21.3682H18.2454Z"
        fill="white"
      />
      <path
        d="M16.5346 28.0729H15.4607C15.3794 28.0729 15.3133 28.0519 15.2621 28.0098C15.214 27.9677 15.1734 27.9195 15.1403 27.8654L14.1611 26.2545C14.1461 26.3056 14.128 26.3538 14.107 26.3989C14.0889 26.444 14.0679 26.4861 14.0438 26.5252L13.1775 27.8654C13.1444 27.9165 13.1038 27.9646 13.0556 28.0098C13.0075 28.0519 12.9473 28.0729 12.8751 28.0729H11.8779L13.4662 25.686L11.9411 23.4434H13.015C13.0962 23.4434 13.1564 23.4554 13.1955 23.4795C13.2346 23.5005 13.2692 23.5366 13.2993 23.5878L14.2694 25.1309C14.3025 25.0287 14.3491 24.9279 14.4093 24.8286L15.1899 23.6103C15.2561 23.499 15.3418 23.4434 15.4471 23.4434H16.4714L14.9508 25.6363L16.5346 28.0729Z"
        fill="white"
      />
      <path
        d="M10.0977 27.4597C10.0977 27.3664 10.1142 27.2777 10.1473 27.1934C10.1834 27.1092 10.2315 27.037 10.2917 26.9769C10.3518 26.9167 10.424 26.8686 10.5083 26.8325C10.5925 26.7964 10.6827 26.7783 10.779 26.7783C10.8753 26.7783 10.964 26.7964 11.0452 26.8325C11.1295 26.8686 11.2017 26.9167 11.2618 26.9769C11.325 27.037 11.3746 27.1092 11.4107 27.1934C11.4468 27.2777 11.4649 27.3664 11.4649 27.4597C11.4649 27.5559 11.4468 27.6462 11.4107 27.7304C11.3746 27.8116 11.325 27.8823 11.2618 27.9425C11.2017 28.0026 11.1295 28.0493 11.0452 28.0824C10.964 28.1185 10.8753 28.1365 10.779 28.1365C10.6827 28.1365 10.5925 28.1185 10.5083 28.0824C10.424 28.0493 10.3518 28.0026 10.2917 27.9425C10.2315 27.8823 10.1834 27.8116 10.1473 27.7304C10.1142 27.6462 10.0977 27.5559 10.0977 27.4597Z"
        fill="white"
      />
    </svg>
  ),
  "application/vnd.ms-excel": (
    <svg
      width="38"
      height="38"
      viewBox="0 0 38 38"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
    >
      <path d="M5.5 31.0801H3L5.5 33.5801V31.0801Z" fill="#006C36" />
      <path
        d="M32.7998 31.0801H35.2998L32.7998 33.5801V31.0801Z"
        fill="#006C36"
      />
      <path
        d="M6.35552 2.21162C6.91384 1.59227 7.66518 1.25 8.44238 1.25H25.9153L32.832 8.92294V33.0872C32.832 33.9743 32.514 34.8206 31.955 35.4408C31.3966 36.0601 30.6453 36.4024 29.8681 36.4024H8.44238C7.66518 36.4024 6.91384 36.0601 6.35552 35.4408C5.79644 34.8206 5.47852 33.9743 5.47852 33.0872V4.56524C5.47852 3.67809 5.79644 2.83184 6.35552 2.21162Z"
        fill="#EBFAF3"
        stroke="#00A251"
        strokeWidth="0.5"
      />
      <path d="M3 18.8262H35.31V31.0817H3V18.8262Z" fill="#008743" />
      <path
        d="M27.4545 28.0729H26.3806C26.2994 28.0729 26.2332 28.0519 26.182 28.0098C26.1339 27.9677 26.0933 27.9195 26.0602 27.8654L25.0811 26.2545C25.066 26.3056 25.048 26.3538 25.0269 26.3989C25.0089 26.444 24.9878 26.4861 24.9637 26.5252L24.0974 27.8654C24.0643 27.9165 24.0237 27.9646 23.9756 28.0098C23.9274 28.0519 23.8673 28.0729 23.7951 28.0729H22.7979L24.3862 25.686L22.861 23.4434H23.9349C24.0162 23.4434 24.0763 23.4554 24.1154 23.4795C24.1545 23.5005 24.1891 23.5366 24.2192 23.5878L25.1893 25.1309C25.2224 25.0287 25.2691 24.9279 25.3292 24.8286L26.1098 23.6103C26.176 23.499 26.2618 23.4434 26.367 23.4434H27.3913L25.8707 25.6363L27.4545 28.0729Z"
        fill="white"
      />
      <path
        d="M22.1804 24.3467C22.1504 24.3948 22.1188 24.4294 22.0857 24.4505C22.0526 24.4685 22.0105 24.4776 21.9593 24.4776C21.9052 24.4776 21.8465 24.4625 21.7834 24.4325C21.7232 24.4024 21.6525 24.3693 21.5713 24.3332C21.4901 24.2941 21.3968 24.2595 21.2915 24.2294C21.1892 24.1993 21.0674 24.1843 20.926 24.1843C20.7064 24.1843 20.5335 24.2309 20.4071 24.3242C20.2838 24.4174 20.2221 24.5392 20.2221 24.6896C20.2221 24.7889 20.2537 24.8731 20.3169 24.9423C20.3831 25.0085 20.4688 25.0672 20.5741 25.1183C20.6824 25.1695 20.8042 25.2161 20.9396 25.2582C21.0749 25.2973 21.2118 25.3409 21.3502 25.389C21.4916 25.4372 21.6299 25.4928 21.7653 25.556C21.9007 25.6162 22.021 25.6944 22.1263 25.7906C22.2346 25.8839 22.3203 25.9967 22.3835 26.1291C22.4497 26.2614 22.4828 26.4209 22.4828 26.6074C22.4828 26.83 22.4421 27.036 22.3609 27.2255C22.2827 27.412 22.1654 27.5745 22.009 27.7129C21.8525 27.8482 21.6585 27.955 21.4269 28.0332C21.1983 28.1084 20.9335 28.146 20.6327 28.146C20.4733 28.146 20.3169 28.131 20.1635 28.1009C20.013 28.0738 19.8672 28.0347 19.7258 27.9836C19.5874 27.9325 19.458 27.8723 19.3377 27.8031C19.2204 27.7339 19.1166 27.6587 19.0264 27.5775L19.2836 27.1533C19.3167 27.1022 19.3558 27.0631 19.4009 27.036C19.446 27.009 19.5032 26.9954 19.5724 26.9954C19.6415 26.9954 19.7062 27.015 19.7664 27.0541C19.8295 27.0932 19.9017 27.1353 19.983 27.1804C20.0642 27.2255 20.1589 27.2677 20.2672 27.3068C20.3785 27.3459 20.5184 27.3654 20.6869 27.3654C20.8192 27.3654 20.932 27.3504 21.0253 27.3203C21.1216 27.2872 21.1998 27.2451 21.2599 27.194C21.3231 27.1428 21.3682 27.0842 21.3953 27.018C21.4254 26.9488 21.4404 26.8781 21.4404 26.8059C21.4404 26.6976 21.4073 26.6089 21.3412 26.5397C21.278 26.4705 21.1923 26.4103 21.084 26.3592C20.9787 26.308 20.8568 26.2629 20.7185 26.2238C20.5831 26.1817 20.4432 26.1366 20.2988 26.0885C20.1574 26.0403 20.0176 25.9847 19.8792 25.9215C19.7438 25.8553 19.622 25.7726 19.5137 25.6733C19.4084 25.5741 19.3227 25.4522 19.2565 25.3078C19.1933 25.1634 19.1617 24.989 19.1617 24.7844C19.1617 24.5949 19.1993 24.4144 19.2745 24.2429C19.3497 24.0715 19.4595 23.9226 19.6039 23.7962C19.7513 23.6669 19.9333 23.5646 20.1499 23.4894C20.3695 23.4112 20.6222 23.3721 20.908 23.3721C21.2268 23.3721 21.5171 23.4247 21.7788 23.53C22.0406 23.6353 22.2586 23.7737 22.4331 23.9451L22.1804 24.3467Z"
        fill="white"
      />
      <path
        d="M18.2454 21.3682V28.0734H17.1309V21.3682H18.2454Z"
        fill="white"
      />
      <path
        d="M16.5346 28.0729H15.4607C15.3794 28.0729 15.3133 28.0519 15.2621 28.0098C15.214 27.9677 15.1734 27.9195 15.1403 27.8654L14.1611 26.2545C14.1461 26.3056 14.128 26.3538 14.107 26.3989C14.0889 26.444 14.0679 26.4861 14.0438 26.5252L13.1775 27.8654C13.1444 27.9165 13.1038 27.9646 13.0556 28.0098C13.0075 28.0519 12.9473 28.0729 12.8751 28.0729H11.8779L13.4662 25.686L11.9411 23.4434H13.015C13.0962 23.4434 13.1564 23.4554 13.1955 23.4795C13.2346 23.5005 13.2692 23.5366 13.2993 23.5878L14.2694 25.1309C14.3025 25.0287 14.3491 24.9279 14.4093 24.8286L15.1899 23.6103C15.2561 23.499 15.3418 23.4434 15.4471 23.4434H16.4714L14.9508 25.6363L16.5346 28.0729Z"
        fill="white"
      />
      <path
        d="M10.0977 27.4597C10.0977 27.3664 10.1142 27.2777 10.1473 27.1934C10.1834 27.1092 10.2315 27.037 10.2917 26.9769C10.3518 26.9167 10.424 26.8686 10.5083 26.8325C10.5925 26.7964 10.6827 26.7783 10.779 26.7783C10.8753 26.7783 10.964 26.7964 11.0452 26.8325C11.1295 26.8686 11.2017 26.9167 11.2618 26.9769C11.325 27.037 11.3746 27.1092 11.4107 27.1934C11.4468 27.2777 11.4649 27.3664 11.4649 27.4597C11.4649 27.5559 11.4468 27.6462 11.4107 27.7304C11.3746 27.8116 11.325 27.8823 11.2618 27.9425C11.2017 28.0026 11.1295 28.0493 11.0452 28.0824C10.964 28.1185 10.8753 28.1365 10.779 28.1365C10.6827 28.1365 10.5925 28.1185 10.5083 28.0824C10.424 28.0493 10.3518 28.0026 10.2917 27.9425C10.2315 27.8823 10.1834 27.8116 10.1473 27.7304C10.1142 27.6462 10.0977 27.5559 10.0977 27.4597Z"
        fill="white"
      />
    </svg>
  ),
};

const PolicyTemplate: FunctionComponent<PolicyTemplateProps> = ({}) => {
  const { data: session } = useSession();
  const [uploadUrl, setUploadUrl] = useState<string | null>(null);
  const [error, setError] = useState<string | null>(null);
  const router = useRouter();
  const pathname = usePathname();
  const params = useParams();
  const searchParams = useSearchParams();
  const frameworkSlug = params["framework-slug"] as string;
  const title = searchParams.get("title") as string;
  const templateSlug = searchParams.get("slug") as string;
  const [progress, setProgress] = useState<number>(0);
  const { mutate: presignedUrlMutation } =
    api.general.getS3PresignedUrl.useMutation();

  const { getRootProps, getInputProps, open, acceptedFiles } = useDropzone({
    noClick: true,
    noKeyboard: true,
    maxFiles: 1,
    accept: {
      "application/vnd.openxmlformats-officedocument.wordprocessingml.document":
        [".docx"],
      "application/msword": [".doc"],
      "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet": [
        ".xlsx",
      ],
      "application/vnd.ms-excel": [".xls"],
    },
    onDropAccepted: async (files) => {
      const file = files[0] as File;

      await axios
        .put(uploadUrl as string, file, {
          headers: {
            "Content-Type": file.type,
          },
          onUploadProgress: (progressEvent) => {
            if (progressEvent.total) {
              const progress =
                (progressEvent.loaded / progressEvent.total) * 100;
              setProgress(progress);
              console.log(`Upload Progress: ${progress.toFixed(2)}%`);
            }
          },
        })
        .catch((error) => {
          if (error instanceof AxiosError) {
            console.log(error.response?.data);
            setError("axios error");
          }
        });
    },
  });

  useEffect(() => {
    presignedUrlMutation(
      {
        type: "POLICY_DOCUMENT",
        objectKey: `${session?.user.organisationId}/${frameworkSlug}/${templateSlug}`,
      },
      {
        onSuccess: (data) => {
          console.log(data);
          setUploadUrl(data.url);
        },
        onError: (error) => {
          console.error("Error getting presigned URL:", error);
        },
      },
    );
  }, []);

  const onOpenChange = () => {
    if (Boolean(title && templateSlug)) {
      router.replace(pathname, {
        scroll: false,
      });
    }
  };

  return (
    <Sheet open={Boolean(title && templateSlug)} onOpenChange={onOpenChange}>
      <SheetContent>
        <div className="flex flex-col gap-10">
          <SheetHeader>
            <SheetTitle>{title}</SheetTitle>
            <SheetDescription>
              Download this{" "}
              <Link
                href={`https://cybermap-dev-server-policytemplates-frzaumot.s3.us-east-1.amazonaws.com/${frameworkSlug}/${templateSlug}`}
                className="text-blue-500"
                target="_blank"
              >
                {title} template
              </Link>{" "}
              and upload here after filling
            </SheetDescription>
          </SheetHeader>

          <div {...getRootProps({ className: "dropzone" })}>
            <input {...getInputProps()} />
            <div className="rounded-md border-2 border-[#CDCED7] border-dashed bg-[#FCFCFD] p-6 text-center">
              <div className="flex items-center justify-center gap-4">
                <svg
                  width="48"
                  height="48"
                  viewBox="0 0 48 48"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M32 32L24 24L16 32"
                    stroke="#A0AEC0"
                    strokeWidth="2"
                    strokeLinecap="round"
                    strokeLinejoin="round"
                  />
                  <path
                    d="M24 24V42"
                    stroke="#A0AEC0"
                    strokeWidth="2"
                    strokeLinecap="round"
                    strokeLinejoin="round"
                  />
                  <path
                    d="M40.78 36.78C42.7307 35.7166 44.2717 34.0338 45.1598 31.9973C46.0478 29.9608 46.2324 27.6865 45.6844 25.5334C45.1364 23.3803 43.887 21.4711 42.1334 20.1069C40.3797 18.7428 38.2217 18.0015 36 18H33.48C32.8746 15.6585 31.7463 13.4847 30.1799 11.642C28.6135 9.79933 26.6497 8.33573 24.4362 7.36124C22.2227 6.38676 19.8171 5.92675 17.4002 6.01579C14.9834 6.10484 12.6181 6.74063 10.4824 7.87536C8.34658 9.01009 6.49583 10.6142 5.06926 12.5672C3.64268 14.5202 2.67739 16.7711 2.24597 19.1508C1.81455 21.5305 1.92822 23.9771 2.57844 26.3066C3.22865 28.636 4.3985 30.7878 6.00001 32.6"
                    stroke="#A0AEC0"
                    strokeWidth="2"
                    strokeLinecap="round"
                    strokeLinejoin="round"
                  />
                  <path
                    d="M32 32L24 24L16 32"
                    stroke="#A0AEC0"
                    strokeWidth="2"
                    strokeLinecap="round"
                    strokeLinejoin="round"
                  />
                </svg>

                <div className="flex flex-col gap-2">
                  <p className="text-gray-500 text-sm">
                    Select a file or drag and drop here
                  </p>
                  <p className="text-gray-400 text-xs">
                    WORD or XLSX file no more than 10MB
                  </p>
                </div>

                <Button
                  variant="outline"
                  size="sm"
                  className="text-xs"
                  onClick={open}
                >
                  SELECT FILE
                </Button>
              </div>
            </div>
          </div>

          {acceptedFiles.map((file, idx) => {
            return (
              <div
                key={idx}
                className={cn(
                  "relative border border-[#CDCED7] bg-[#FCFCFD] text-sm",
                  {
                    "bg-red-500": error,
                  },
                )}
              >
                <div className="flex justify-between p-4">
                  <div className="flex items-center gap-2">
                    {MimeTypeIconMap[file.type as keyof typeof MimeTypeIconMap]}
                    <span>
                      <span className="inline-flex items-center gap-2">
                        <span className="truncate">
                          {file.name.length > 35
                            ? file.name.substring(0, 32) + "..."
                            : file.name}
                        </span>
                        {progress === 100 ? (
                          <CheckmarkCircle04Icon
                            className="text-green-600"
                            size={20}
                          />
                        ) : (
                          ""
                        )}{" "}
                      </span>
                      <span className="block text-gray-400 text-xs">
                        {humanFileSize(file.size)}
                      </span>
                    </span>
                  </div>
                  {progress === 100 ? <Delete02Icon /> : ""}
                </div>

                {progress !== 100 ? (
                  <div className="absolute bottom-0 w-full rounded-full bg-gray-200 dark:bg-gray-700">
                    <div
                      className="h-1 rounded-full bg-blue-600"
                      style={{ width: `${progress}%` }}
                    ></div>
                  </div>
                ) : (
                  ""
                )}
              </div>
            );
          })}
        </div>

        <SheetFooter className="absolute right-6 bottom-12">
          <Button variant="outline" onClick={onOpenChange}>
            Cancel
          </Button>
          <Button onClick={onOpenChange}>Save Policy</Button>
        </SheetFooter>
      </SheetContent>
    </Sheet>
  );
};

export default PolicyTemplate;
